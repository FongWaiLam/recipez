{% extends 'recipez/includes/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title_block %}
{% endblock %}

{% block body_block %}
    <section>
        <div class="container my-5 py-5">
            <div class="row d-flex justify-content-center">
                <div class="col-md-12 col-lg-10 col-xl-8">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex flex-start align-items-center">
                                <!-- Recipe Creator -->
                                <img alt="{{ recipe.user.username }}'s profile image"
                                     class="rounded-circle shadow-1-strong me-3"
                                     src="{{ MEDIA_URL }}{{ recipe.user.avatar }}"
                                     width="50"/>
                                <div>
                                    <h6 class="fw-bold text-primary mb-1">{{ recipe.user }}</h6>
                                    <!-- Recipe Creator -->
                                    <p class="text-muted small mb-0">
                                        {{ recipe.creation_time }}
                                    </p>
                                </div>
                            </div>

                            <!-- Recipe Content -->
                            <p class="mt-3 mb-4">
                            <h2>{{ recipe.name }}</h2>
                            <img src="{{ MEDIA_URL }}{{ recipe.photo }}"
                                 width="400"
                                 alt="{{ recipe.name }}'s image"/><br><br>
                            <small><b>Time:</b>&nbsp{{ recipe.cooking_duration }}</small>
                            <small><b>Level:</b>&nbsp{{ recipe.difficulty }}</small><br><br>
                            <small><b>Category:</b>&nbsp{{ recipe.category }}</small>
                            <small><b>Region:</b>&nbsp{{ recipe.region }}</small>
                            <small><b>Vegan:</b>&nbsp{{ recipe.is_vegan }}<br></small><br><br>
                            <p><b>Methodology:</b>&nbsp<br><br>{{ recipe.detail }}</p>
                            </p>
                            <!-- Recipe Content -->
                            <div class="small d-flex justify-content-start">
                                <small>{{ recipe.likes }} </small> <br>
                                <a href="#!" class="d-flex align-items-center me-3">
                                    <p class="mb-0">Like</p>
                                </a>
                                <button onclick="copyUrl()">Share</button>
                                <script>
                                    function copyUrl() {
                                        navigator.clipboard.writeText(this.location.href);
                                        alert("Copied to clipboard!");
                                    }
                                </script>
                                </a>
                            </div>
                        </div>

                        <div class="card-footer py-3 border-0" style="background-color: #f0f2f5;">
                            <br>
                            {% if comments %}
                                {% for comment in comments %}
                                    <div>
                                        <div class="card mb-4">
                                            <div class="card-body">
                                                {% if all_users %}
                                                    {% for user in all_users %}
                                                        {% if user.user.username == comment.username %}
                                                            <!-- Get User's avatar-->
                                                            <img alt="{{ user.user.username }}'s profile image"
                                                                 class="rounded-circle"
                                                                 src="{{ MEDIA_URL }}{{ user.user.user_profile.avatar }}"
                                                                 width="30">
                                                        {% endif %}
                                                    {% endfor %}
                                                {% endif %}
                                                <p><b>{{ comment.username }}</b>&nbsp&nbsp{{ comment.creation_time }}
                                                </p> <br>
                                                <p>{{ comment.detail }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                {# <strong>There are no comments present.</strong><br>#}
                            {% endif %}


                            <!-- Comments-->
                            {% if user.is_authenticated %}
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <div class="d-flex flex-start w-100">
                                            <img class="rounded-circle shadow-1-strong me-3"
                                                 src="{{ MEDIA_URL }}{{ user.user_profile.avatar }}"
                                                 alt="{{ user.username }}'s profile image"
                                                 width="40"
                                                 height="40"/>
                                            <div class="form-outline w-100">
                                                <form id="comment_form" method="post"
                                                      action="{% url 'recipez:show_recipe' recipe.id %}">
                                                    {% csrf_token %}
                                                    {% for hidden in form.hidden_fields %}
                                                        {{ hidden }}
                                                    {% endfor %}
                                                    {% for field in form.visible_fields %}
                                                        {{ field.errors }}
                                                        {{ field.help_text }}
                                                        {% if field.name == 'rating' %}
                                                            <p>Rating:&nbsp</p>{{ field }}
                                                        {% elif field.name == 'detail' %}
                                                            <p>Comment:&nbsp</p>{{ field }}
                                                        {% endif %}
                                                    {% endfor %}
                                                    <div class="float-end mt-2 pt-1">
                                                        <button type="submit" class="btn btn-primary btn-sm"
                                                                name="submit"
                                                                value="Create comment">Post comment
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                            <!-- Comments-->
                        </div>
                    </div>
                </div>
            </div>
    </section>
{% endblock %}